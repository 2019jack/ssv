version: '3.5'

services:

  ssv-node-debug:
    build:
      context: .
      dockerfile: Dockerfile.debug
    command: "--listen=:2345 --headless=true --log=true --log-output=debugger,debuglineerr,gdbwire,lldbout,rpc --accept-multiclient --api-version=2 exec /go/bin/ssvnode start-node -- --node-id=1 --private-key=${SSV_NODE_1} --validator-key=${VALIDATOR_PUBLIC_KEY} --beacon-node-addr=${BEACON_NODE_ADDR} --network=${NETWORK} --val=${CONSENSUS_TYPE}"
    environment:
      DOCKER_COMPOSE: "true"
      PUBKEY_NODE_2: ${SSV_NODE_PUB_KEY_2}
      PUBKEY_NODE_3: ${SSV_NODE_PUB_KEY_3}
    ports:
      - "2345:2345"
      - "40000:40000"
    security_opt:
      - "seccomp:unconfined"
    networks:
      - bloxapp-docker
    volumes:
      - ./:/cmd/ssvnode
    restart: always

  ssv-node-1:
    build:
      context: .
      dockerfile: Dockerfile
    command:
      - "start-node"
      - "--node-id=2"
      - "--private-key=${SSV_NODE_2}"
      - "--validator-key=${VALIDATOR_PUBLIC_KEY}"
      - "--beacon-node-addr=${BEACON_NODE_ADDR}"
      - "--network=${NETWORK}"
      - "--val=${CONSENSUS_TYPE}"
    environment:
      DOCKER_COMPOSE: "true"
      PUBKEY_NODE_1: ${SSV_NODE_PUB_KEY_1}
      PUBKEY_NODE_3: ${SSV_NODE_PUB_KEY_3}
    networks:
      - bloxapp-docker
    restart: always

  ssv-node-2:
      build:
        context: .
        dockerfile: Dockerfile
      command:
        - "start-node"
        - "--node-id=3"
        - "--private-key=${SSV_NODE_3}"
        - "--validator-key=${VALIDATOR_PUBLIC_KEY}"
        - "--beacon-node-addr=${BEACON_NODE_ADDR}"
        - "--network=${NETWORK}"
        - "--val=${CONSENSUS_TYPE}"
      environment:
        DOCKER_COMPOSE: "true"
        PUBKEY_NODE_1: ${SSV_NODE_PUB_KEY_1}
        PUBKEY_NODE_2: ${SSV_NODE_PUB_KEY_2}
      networks:
        - bloxapp-docker
      restart: always

networks:
  bloxapp-docker:
    driver: bridge
    name: bloxapp-docker